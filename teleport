-- KAVO UI LIBRARY
local Kavo = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Kavo.CreateLib("GHOST DRONE V5 - PRO", "Midnight")

-- SERVICES
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local TS = game:GetService("TweenService")
local LP = game.Players.LocalPlayer

-- SETTINGS
local droneActive = false
local droneSpeed = 2
local dronePos = Vector3.new(0, 100, 0)
local droneRot = Vector3.new(-90, 0, 0)

-- UI TABS
local Tab = Window:NewTab("Drone & Teleport")
local Section = Tab:NewSection("Drone Kontrol Paneli")

-- AYDINLIK HARİTA PANELİ
local DroneGui = Instance.new("ScreenGui", game.CoreGui)
local Viewport = Instance.new("ViewportFrame", DroneGui)
Viewport.Size = UDim2.new(0, 250, 0, 250)
Viewport.Position = UDim2.new(0, 10, 0.5, -125)
Viewport.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Viewport.BorderSizePixel = 2
Viewport.Visible = false

-- SİYAHLIK SORUNU ÇÖZÜMÜ (IŞIKLANDIRMA)
Viewport.Ambient = Color3.fromRGB(255, 255, 255) 
Viewport.LightColor = Color3.fromRGB(255, 255, 255)
Viewport.LightDirection = Vector3.new(0, -1, 0)

local Camera = Instance.new("Camera", Viewport)
Viewport.CurrentCamera = Camera

-- HARİTA YENİLEME FONKSİYONU
local function refreshMap()
    Viewport:ClearAllChildren()
    local World = Instance.new("WorldModel", Viewport)
    for _, v in pairs(game.Workspace:GetChildren()) do
        if v:IsA("BasePart") and v.Transparency < 0.8 then
            local clone = v:Clone()
            clone.Parent = World
        end
    end
end

-- DRONE HAREKET DÖNGÜSÜ
RunService.RenderStepped:Connect(function()
    if droneActive then
        -- WASD Kontrol
        if UIS:IsKeyDown(Enum.KeyCode.W) then dronePos = dronePos + (Camera.CFrame.LookVector * droneSpeed) end
        if UIS:IsKeyDown(Enum.KeyCode.S) then dronePos = dronePos - (Camera.CFrame.LookVector * droneSpeed) end
        if UIS:IsKeyDown(Enum.KeyCode.A) then dronePos = dronePos - (Camera.CFrame.RightVector * droneSpeed) end
        if UIS:IsKeyDown(Enum.KeyCode.D) then dronePos = dronePos + (Camera.CFrame.RightVector * droneSpeed) end
        -- Yükseklik (Space/Shift)
        if UIS:IsKeyDown(Enum.KeyCode.Space) then dronePos = dronePos + Vector3.new(0, droneSpeed, 0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then dronePos = dronePos - Vector3.new(0, droneSpeed, 0) end
        
        -- Kamera Güncelleme
        Camera.CFrame = CFrame.new(dronePos) * CFrame.Angles(math.rad(droneRot.X), math.rad(droneRot.Y), math.rad(droneRot.Z))
    end
end)

-- TIKLA IŞINLAN MANTIĞI
Viewport.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 and droneActive then
        if LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
            -- Drone'un bulunduğu tam koordinata ışınla
            TS:Create(LP.Character.HumanoidRootPart, TweenInfo.new(0.5), {CFrame = CFrame.new(dronePos)}):Play()
        end
    end
end)

-- MENU BUTONLARI
Section:NewToggle("Drone Modunu Aktif Et", "Haritayı açar ve serbest kamerayı başlatır", function(state)
    droneActive = state
    Viewport.Visible = state
    if state then 
        dronePos = LP.Character.HumanoidRootPart.Position + Vector3.new(0, 50, 0)
        refreshMap() 
    end
end)

Section:NewSlider("Drone Hızı", "Uçuş hızını ayarlar", 15, 1, function(s)
    droneSpeed = s
end)

Section:NewButton("Haritayı Aydınlat / Yenile", "Görüntüde hata varsa bas", function()
    refreshMap()
end)

Section:NewButton("Harita Konumunu Sıfırla", "Haritayı sol tarafa sabitler", function()
    Viewport.Position = UDim2.new(0, 10, 0.5, -125)
end)
